<!DOCTYPE html>
<html>
<head>
    <title>Position Training</title>
    <meta charset="UTF-8">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="css/classifier.min.css"> -->
    <meta name="viewport" content="width=device-width"/>
</head>
<body>
  <h1>{{ title }}</h1>
  <!-- <img src="{{ image }}"/> -->
  <canvas id="view"></canvas>
  <br>
  {% for label in labels %}
  <button style="display:none;" class="pos-button" id="b-{{ label }}" type="button">
    {{ label }}
  </button>
  {% endfor %}
  <script src="https://code.jquery.com/jquery-2.2.3.min.js"
          integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="
          crossorigin="anonymous"></script>
  <script>
    $(document).ready(function () {
      var buttons = document.getElementsByClassName('pos-button')
      var canvas = document.getElementById("view");
      var context = canvas.getContext("2d");
      var img = new Image();
      var count = 0;
      var glyph_coords = {{ glyph_coords | safe }};
      var num_coords = glyph_coords.length;
      var agh = {{ agh }};
      var positions = [];

      num_coords = 5;

      window.onload = function () {
        img.onload = function () {
          show_glyph();
          for (var i=0;i < buttons.length; i++) {
            buttons[i].style.display = "inline-block";
          }
        };
        img.src = '{{ image }}';
      };

      $('.pos-button').click(
        function () {
          positions.push(this.id.slice(2));
          console.log(positions);
          show_glyph();
        });

      function show_glyph() {
        if (count < num_coords) {
          context.drawImage(img,
            glyph_coords[count][1],
            glyph_coords[count][0] - 3 * agh,
            glyph_coords[count][3],
            glyph_coords[count][2] + 6 * agh,
            135, 10, 30, 150
          );
          count = count + 1;
        } else {
          $.ajax({
              url: '',
              type: 'POST',
              data: JSON.stringify({'user_input': positions}),
              contentType: 'application/json'
          });
          close();
        }

      };
    });
  </script>
</body>
</html>
